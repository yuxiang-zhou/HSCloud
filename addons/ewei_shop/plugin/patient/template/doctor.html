{template 'web/_header'}
{template 'tabs'}
{if $operation=='post'}

<div class="main">
    <form id="dataform" action="" method="post" class="form-horizontal form" onsubmit='return formcheck()'>
        <div class='panel panel-default'>
            <div class='panel-heading'>
                  医生信息     
            </div>
            <div class='panel-body'>
                
                   <ul class="nav nav-arrow-next nav-tabs" id="myTab">
                    <li class="active" ><a href="#tab_basic">基本信息</a></li>
                    <li><a href="#tab_act">就诊时间设置</a></li>
                </ul> 
            {if !empty($item['id'])} 
                <div class="form-group">
                <label class="col-xs-12 col-sm-3 col-md-2 control-label">医生连接(点击复制)</label>
                <div class="col-sm-9 col-xs-12">
                    <p class='form-control-static'><a href='javascript:;' title='点击复制连接' id='cp'>{php echo $this->createPluginMobileUrl('patient/detail',array('id'=>$item['id']))}</a></p>
                </div>
             </div>
                {/if}
                
                <div class="tab-content">
                    <div class="tab-pane  active" id="tab_basic">{template 'doctor/basic'}</div>
                    <div class="tab-pane" id="tab_act">{template 'doctor/act'}</div>
            </div>
        <div class='panel-body'>
               
                    <div class="form-group"></div>
                   <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label"></label>
                    <div class="col-sm-9 col-xs-12">
                       {ife 'patient.doctor' $item}
                            <input type="submit" name="submit" value="提交" class="btn btn-primary col-lg-1"  />
                            <input type="hidden" name="token" value="{$_W['token']}" />
                       {/if}
                       
                       <input type="button" name="back" onclick='history.back()' {ifp 'patientadv.add|patientadv.edit'}style='margin-left:10px;'{/if} value="返回列表" class="btn btn-default" />
                    </div>
        </div>
        </div>
                     
            </div>
    </form>
</div>
<script language='javascript'>
     window.optionchanged = false;
        require(['bootstrap'],function(){
             $('#myTab a').click(function (e) {
                 e.preventDefault();
                 $(this).tab('show');
             })
     });
	 require(['util'], function (u) {
        $('#cp').each(function () {
            u.clip(this, $(this).text());
        });
    })
    function formcheck(){
        
        if($('select[name=cate]').val()==''){
            $('#myTab a[href="#tab_basic"]').tab('show');
            Tip.focus($('select[name=cate]'),'请选择科室!');
            return false;
        }
        
        if($(':input[name=title]').val()==''){
            $('#myTab a[href="#tab_basic"]').tab('show');
            Tip.focus($(':input[name=title]'),'请填写医生名称!');
            return false;
        }

        if($(':input[name=technicaltitle]').val()==''){
            $('#myTab a[href="#tab_basic"]').tab('show');
            Tip.focus($(':input[name=technicaltitle]'),'请填写医生职称!');
            return false;
        }

        if($(':input[name=skill]').val()==''){
            $('#myTab a[href="#tab_basic"]').tab('show');
            Tip.focus($(':input[name=skill]'),'请填写医生主治项目!');
            return false;
        }
        return true;
    }
        function search_doctor() {
             if( $.trim($('#search-kwd-doctor').val())==''){
                 Tip.focus('#search-kwd-doctor','请输入关键词');
                 return;
             }
		$("#module-menus-doctor").html("正在搜索....")
		$.get('{php echo $this->createWebUrl('shop/query')}', {
			keyword: $.trim($('#search-kwd-doctor').val())
		}, function(dat){
			$('#module-menus-doctor').html(dat);
		});
	}
	function select_good(o) {
                              $("#doctorid").val(o.id);
                               $(":input[name=thumb]").val(o.thumb);
                               $(".img-thumbnail").attr('src',o.thumb);
                               $(":input[name=title]").val(o.title);
                                $(":input[name=total]").val(o.total);
                                $(":input[name=price]").val(o.marketprice);
   	               $("#modal-module-menus-doctor .close").click();
	}
</script>
 
{elseif $operation == 'display'}
<form action="" method="get" class='form form-horizontal'>
    <div class="panel panel-info">
        <div class="panel-heading">筛选</div>
        <div class="panel-body">
            <form action="./index.php" method="get" class="form-horizontal" plugins="form">
                <input type="hidden" name="c" value="site" />
                <input type="hidden" name="a" value="entry" />
                <input type="hidden" name="m" value="ewei_shop" />
                <input type="hidden" name="do" value="plugin" />
                <input type="hidden" name="p"  value="patient" />
                <input type="hidden" name="method"  value="doctor" />
                <input type="hidden" name="op" value="display" />
                <div class="form-group">
                  <label class="col-xs-12 col-sm-2 col-md-2 col-lg-1 control-label">关键词</label>
                    <div class="col-xs-12 col-sm-8 col-lg-9">
                        <input class="form-control" name="keyword" id="" type="text" value="{$_GPC['keyword']}" placeholder="可搜索医生名称">
                    </div>
                </div>
                 <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-1 control-label">科室</label>
                       <div class="col-xs-12 col-sm-8 col-lg-9">
                           <select class='form-control' name='cate'>
                                <option value=''></option>
                                 {loop $category $cate}
                                 <option value='{$cate['id']}' {if $_GPC['cate']==$cate['id']}selected{/if}>{$cate['name']}</option>
                                 {/loop}
                            </select>
                     </div>
                </div>
                
                 <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-1 control-label">排班</label>
                       <div class="col-xs-12 col-sm-8 col-lg-9">
                       <select name='type' class='form-control'>
                          <option value='' {if $_GPC['type']==''}selected{/if}></option>
                          <option value='0' {if $_GPC['type']=='0'}selected{/if}>普通门诊</option>
                          <option value='1' {if $_GPC['type']=='1'}selected{/if} >专家门诊</option>
                       </select> 
                     </div>
                </div>
                   <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-1 control-label">状态</label>
                       <div class="col-xs-12 col-sm-8 col-lg-9">
                       <select name='status' class='form-control'>
                          <option value='' {if $_GPC['status']==''}selected{/if}></option>
                          <option value='0' {if $_GPC['status']=='0'}selected{/if}>隐藏</option>
                          <option value='1' {if $_GPC['status']=='1'}selected{/if} >显示</option>
                       </select> 
                     </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-1 control-label"> </label>
                      <div class="col-xs-12 col-sm-2 col-lg-2">
                        <button class="btn btn-default"><i class="fa fa-search"></i> 搜索</button>
                    </div>
                </div>
        </div>
    </div>
    </form>
            
    <form action="" method="post">
    <div class='panel panel-default'>
        <div class='panel-heading' >
            医生管理 (数量: {$total} 条)
     
        </div>
        <div class='panel-body'>

            <table class="table">
                <thead>
                  <tr>
                        <th style="width:60px;">ID</th>
                        <th style="width:80px;">排序</th>
                        <th>医生名称</th>
                        <th style='width:100px;'>排班</th>      
                        <th style='width:300px;'>职称</th>      
                        <th style='width:100px;'>浏览次数</th>
                        <th style='width:100px;' >状态</th>
                        <th style="">操作</th>
                    </tr>
                </thead>
                <tbody>
                    {loop $list $row}
                         <td>{$row['id']}</td>
                          <td>
                              {ifp 'patient.doctor.edit'}
                              <input type="text" class="form-control" name="displayorder[{$row['id']}]" value="{$row['displayorder']}">
                               {else}
                              {$row['displayorder']}
                              {/if}
                          </td>
                          <td>
                              <span class='label label-primary'>{$category[$row['cate']]['name']}</span><br/>{$row['title']}
                          </td>
                          <td>{if $row['type']==1}
                              <span class='label label-danger'>专家门诊</span>
                              {else}
                              <span class='label label-primary'>普通门诊</span>
                              {/if}
                               </td>
                         <td>{$row['technicaltitle']}</td>
                         <td>{$row['views']}</td>
                           <td>     
                                <label data='{$row['status']}' class='label  label-default {if $row['status']==1}label-success{/if}' {ifp 'patientshop.doctor.edit'}onclick="setProperty(this,{$row['id']},'status')"{/if}>{if $row['status']==1}显示{else}隐藏{/if}</label>
                               
                         </td>
                         <td>
                             {ifp 'patient.doctor.view|patient.doctor.edit'}<a class='btn btn-default' href="{php echo $this->createPluginWebUrl('patient/doctor',array('op'=>'post','id' => $row['id']));}" ><i class='fa fa-edit'></i></a>{/if}
                             {ifp 'patient.doctor.delete'}<a class='btn btn-default' href="{php echo $this->createPluginWebUrl('patient/doctor',array('op'=>'delete','id' => $row['id']));}" title='删除' onclick="return confirm('确定要删除该医生吗？');"><i class='fa fa-remove'></i></a>{/if}
                         </td>
            </tr>
                   {/loop}
                </tbody>
            </table>
            {$pager}
 
        </div>
        
            <div class='panel-footer'>
                   {ifp 'patient.doctor.edit'}
                          <input name="submit" type="submit" class="btn btn-primary" value="提交排序">
                           <input type="hidden" name="token" value="{$_W['token']}" />
                           {/if}
                           
        {ifp 'patient.doctor.add'}                   
                          <a class='btn btn-default' href="{php echo $this->createPluginWebUrl('patient/doctor',array('op'=>'post'))}"><i class='fa fa-plus'></i> 添加医生</a>
                            {/if}
          </div>
      
    </div>
</form>

            <script language='javascript'>
                  function setProperty(obj, id, type) {
                   
                            $(obj).html($(obj).html() + "...");
                   
                            $.post("{php echo $this->createPluginWebUrl('patient/doctor')}",{'op':'setdoctorproperty',id: id, type: type, data: obj.getAttribute("data")},function (d) {
                                            $(obj).html($(obj).html().replace("...", ""));
                                            if (type == 'status') {
                                                $(obj).html(d.data == '1' ? '显示' : '隐藏');
                                            }
                                            $(obj).attr("data", d.data); 
                                            if (d.result == 1) {
                                                $(obj).toggleClass("label-info");
                                            }
                                        }
                            , "json");
                        }
                </script>

{/if}
{template 'web/_footer'}
 