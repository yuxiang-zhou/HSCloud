{template 'common/header'}
<title>{if empty($cate)}快速预约{else}{$cate['name']}{/if}</title>
<link rel="stylesheet" type="text/css" href="../addons/ewei_shop/plugin/patient/template/mobile/default/css/api.css" />
<link rel="stylesheet" type="text/css" href="../addons/ewei_shop/plugin/patient/template/mobile/default/css/common.css" />
<link rel="stylesheet" type="text/css" href="../addons/ewei_shop/plugin/patient/template/mobile/default/css/dep.css" />
		<div id="wrap">

		</div>
<script id='tpl_main' type='text/html'>
			<div id="header">
				<a href="{php echo $this->createPluginMobileUrl('patient')}" class="left" onclick="history.back()"></a><h1>{if empty($cate)}快速预约{else}{$cate['name']}{/if}</h1><a href="{php echo $this->createPluginMobileUrl('patient/depart')}" class="depart"></a>
			</div>
			<div id="main">

			</div>
</script>
<script id='tpl_empty' type='text/html'>
    <div class="record_ico"><i class="fa fa-cubes"></i></div>
    <div class="record_no">未找到任何医生资料~</div>
</script>
<script id='tpl_list' type='text/html'>
			<%each list as doctor%>
				<div class="doctorBg" onclick="location.href='{php echo $this->createPluginMobileUrl('patient/detail')}&id=<%doctor.id%>'">
					<div class="headerBg">
						<h1><%if doctor.type=='1'%>【专家门诊】<%else%>【普通门诊】<%/if%><%doctor.title%></h1>
					</div>
					<div class="content">
						<img class="docHeader" src="<%doctor.thumb%>"></img>
						<h1>职称:<%doctor.technicaltitle%></h1>
						<h2>主治:<%doctor.skill%></h2>
					</div>
				</div>
			<%/each%>
</script>
<script language='javascript'>
    var page= 1;
 
    require(['tpl', 'core'], function(tpl, core) {
       
        core.pjson('patient/lists',{cate:"{$cateid}"},function(json){
                     
                  $('#wrap').html(  tpl('tpl_main',json.result) );
                     
                     if(json.result.total<=0){
                        $('#main').html(  tpl('tpl_empty') );
                        //$('.list_footer').hide();
                     }else{
                           $('#main').html(  tpl('tpl_list',json.result) );
                     }
                     if (json.result.list.length < json.result.pagesize) {
                            return;
                     }
                     var loaded = false;
                      var stop=true; 
                      $(window).scroll(function(){ 
                          if(loaded){ 
                              return;
                          }
                            totalheight = parseFloat($(window).height()) + parseFloat($(window).scrollTop()); 
                            if($(document).height() <= totalheight){ 
                                
                                if(stop==true){ 
                                    stop=false; 
                                    $("#main").append('<div id="list_loading"><i class="fa fa-spinner fa-spin"></i> 正在加载...</div>');
                                    page++;
                                    core.pjson('patient/lists', {page:page,cate:"{$cateid}"}, function(morejson) {  
                                        stop = true;
                                        $('#list_loading').remove();
                                        $("#main").append(tpl('tpl_list', morejson.result));
                                        if (morejson.result.list.length <morejson.result.pagesize) {
                                 
                                            $('#main').append('<div id="list_loading">已经加载完全部记录</div>');
                                            loaded = true;
                                            $(window).scroll = null;
                                            return;
                                        }
                                    },true); 
                                } 
                            } 
                        });
            
                  
              
                     
         },true);
   });
</script>
{template 'common/footer'}