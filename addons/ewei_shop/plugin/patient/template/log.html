{template 'web/_header'}
{template 'tabs'}
 {if $operation=='display'}
<form action="" method="get" class='form form-horizontal'>
    <div class="panel panel-info">
        <div class="panel-heading">筛选</div>
        <div class="panel-body">
            <form action="./index.php" method="get" class="form-horizontal" plugins="form">
                <input type="hidden" name="c" value="site" />
                <input type="hidden" name="a" value="entry" />
                <input type="hidden" name="m" value="ewei_shop" />
                <input type="hidden" name="do" value="plugin" />
                <input type="hidden" name="p"  value="patient" />
                <input type="hidden" name="method"  value="log" />
                <input type="hidden" name="op" value="display" />
         
                <div class="form-group">
                  <label class="col-xs-12 col-sm-2 col-md-2 col-lg-1 control-label">关键词</label>
                    <div class="col-xs-12 col-sm-8 col-lg-9">
                        <input class="form-control" name="keyword" id="" type="text" value="{$_GPC['keyword']}" placeholder="可搜索编号/预约码/医生名字">
                    </div>
                </div>
                  <div class="form-group">
                   <label class="col-xs-12 col-sm-2 col-md-2 col-lg-1 control-label">会员信息</label>
                    <div class="col-xs-12 col-sm-8 col-lg-9">
                        <input class="form-control" name="realname" id="" type="text" value="{$_GPC['realname']}" placeholder="可搜索会员昵称/会员手机号/会员姓名">
                    </div>
                </div>
                    <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-1 control-label">排班</label>
                       <div class="col-xs-12 col-sm-8 col-lg-9">
                       <select name='type' class='form-control'>
                          <option value='' {if $_GPC['type']==''}selected{/if}>全部</option>
                          <option value='0' {if $_GPC['type']=='0'}selected{/if}>普通门诊</option>
                          <option value='1' {if $_GPC['type']=='1'}selected{/if} >专家门诊</option>
                       </select> 
                     </div>
                </div>
                   <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-1 control-label">状态</label>
                       <div class="col-xs-12 col-sm-8 col-lg-9">
                       <select name='status' class='form-control'>
                          <option value='' {if $_GPC['status']==''}selected{/if}></option>
                          <option value='1' {if $_GPC['status']=='1'}selected{/if}>未预约</option>
                          <option value='2' {if $_GPC['status']=='2'}selected{/if} >已预约</option>
                          <option value='3' {if $_GPC['status']=='3'}selected{/if} >已到院</option>
                       </select> 
                     </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-1 control-label">预约时间段</label>
                     <div class="col-sm-2">
                       <select name='searchtime' class='form-control'>
                          <option value='' {if empty($_GPC['searchtime'])}selected{/if}>不搜索</option>
                          <option value='1' {if $_GPC['searchtime']==1}selected{/if} >搜索</option>
                       </select> 
                     </div>
                    <div class="col-sm-7 col-lg-9 col-xs-12">
                        {php echo tpl_form_field_daterange('time', array('starttime'=>date('Y-m-d H:i', $starttime),'endtime'=>date('Y-m-d  H:i', $endtime)),true);}
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-1 control-label"> </label>
                      <div class="col-xs-12 col-sm-2 col-lg-2">
                        <button class="btn btn-default"><i class="fa fa-search"></i> 搜索</button>
                    </div>
                </div>
        </div>
    </div>
    </form>
            
    <form action="" method="post">
    <div class='panel panel-default'>
        <div class='panel-heading' >
            记录管理 (数量: {$total} 条)
     
        </div>
        <div class='panel-body'>

            <table class="table">
                <thead>
                  <tr>
                        <th style="width:60px;">ID</th>
                        <th style='width:220px;'>订单编号</th>
                        <th>医生</th>
                        
                        <th style='width:80px;'>排班</th>
                        <th style='width:150px;'>用户信息</th>
                        <th style='width:100px;'>消耗</th>
                        <th style='width:100px;' >状态</th>
                        <th style='width:100px;' >支付状态</th>
                        <th style='width:200px;' >预约信息</th>
                        <th style="">操作</th>
                    </tr>
                </thead>
                <tbody>
                    {loop $list $row}
                         <td>{$row['id']}</td>
                         <td>{$row['logno']}</td>
                          <td><img src='{php echo tomedia($row['thumb'])}' style='width:30px;height:30px;padding1px;border:1px solid #ccc' /> {$row['title']}</td>
                          <td>{if $row['doctortype']==1}
                              <span class='label label-danger'>专家门诊</span>
                              {else}
                              <span class='label label-primary'>普通门诊</span>
                              {/if}
                         </td>
                         <td><img src='{$row['avatar']}' style='width:30px;height:30px;padding1px;border:1px solid #ccc' /> {$row['nickname']}</td>
                         <td>{if $row['credit']>0}-{$row['credit']}积分<br/>{/if}
                              {if $row['money']>0}
                              -{$row['money']}现金
                              {/if}
                         </td>
                         <td>
                              {if $row['status']==1}
                               <span class='label label-default'>未预约</span>
                              {elseif $row['status']==2}
                              <span class='label label-success'>已预约</span>
                              {elseif $row['status']==3}
                              <span class='label label-danger'>已到院</span>
                              {/if}
                         </td>
                         <td>
                              {if $row['paytype']==-1}
                              <span class='label label-default'>无需支付</span>
                              {else}
                                    {if $row['paytype']==0}
                                        {if $row['paystatus']==0}
                                        <span class='label label-default'>余额未支付</span>
                                        {else}
                                        <span class='label label-warning'>余额已支付</span>
                                        {/if}
                                    {elseif $row['paytype']==1}
                                    {if $row['paystatus']==0}
                                        <span class='label label-default'>微信未支付</span>
                                        {else}
                                        <span class='label label-warning'>微信已支付</span>
                                        {/if}
                                    {/if}
                               {/if}
                         </td>
                         <td>
                                   姓名：{$row['realname']}<br />
                                   手机：{$row['phone']}<br />
                                   日期：{$row['usedate']}
                         </td>
                         <td>
                             <a class='btn btn-default' href="{php echo $this->createPluginWebUrl('patient/log',array('op'=>'detail','id' => $row['id']));}" title='详情' ><i class='fa fa-edit'></i></a>
                             {ifp 'patient.log.exchange'}
                                {if $row['canexchange']}
                                <a class='btn btn-default' href="javascript:;" onclick='exchange({php echo json_encode($row['address'])})' title='确认到院' ><i class='fa fa-exchange'></i></a>
                                {/if}
                             {/if}
                         </td>
                </tr>
                   {/loop}
                </tbody>
            </table>
            {$pager}
        </div>
    </div>
</form>
 {elseif $operation=='detail'}
 
<form class='form-horizontal'>
    <div class='panel panel-default'>
        <div class='panel-heading'>
            预约记录详细信息
        </div>
        <div class='panel-body'>
           
                              
             <div class="form-group">
                <label class="col-xs-12 col-sm-3 col-md-2 control-label">排班</label>
                <div class="col-sm-9 col-xs-12">
                    <div class='form-control-static'>
                         {if $doctor['type']==1}
                              <span class='label label-danger'>专家门诊</span>
                              {else}
                              <span class='label label-primary'>普通门诊</span>
                              {/if}
                    </div>
                </div>
            </div>
                              
               <div class="form-group">
                <label class="col-xs-12 col-sm-3 col-md-2 control-label">医生</label>
                <div class="col-sm-9 col-xs-12">
                     <img src='{php echo tomedia($doctor['thumb'])}' style='width:30px;height:30px;padding:1px;border:1px solid #ccc' />
                         {$doctor['title']}
                </div>
            </div>
                                                   
             <div class="form-group">
                <label class="col-xs-12 col-sm-3 col-md-2 control-label">粉丝</label>
                <div class="col-sm-9 col-xs-12">
                    <img src='{$member['avatar']}' style='width:30px;height:30px;padding:1px;border:1px solid #ccc' />
                         {$member['nickname']}
                </div>
            </div>
             <div class="form-group">
                <label class="col-xs-12 col-sm-3 col-md-2 control-label">消耗</label>
                <div class="col-sm-9 col-xs-12">
                    <div class='form-control-static'>
                        {if $doctor['credit']>0}-{$doctor['credit']}积分<br/>{/if}
                              {if $doctor['money']>0}
                              -{$doctor['money']}现金
                              {/if}
                        
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label class="col-xs-12 col-sm-3 col-md-2 control-label">预约号</label>
                <div class="col-sm-9 col-xs-12">
                     <div class='form-control-static'>{$log['eno']}</div>
                </div>
            </div>

            <div class="form-group">
                <label class="col-xs-12 col-sm-3 col-md-2 control-label">创建时间</label>
                <div class="col-sm-9 col-xs-12">
                    <div class='form-control-static'>{php echo date('Y-m-d H:i:s',$log['createtime'])}</div>
                </div>
            </div>
            
            <div class="form-group">
                <label class="col-xs-12 col-sm-3 col-md-2 control-label">状态</label>
                <div class="col-sm-9 col-xs-12">
                     <div class='form-control-static'>
                              {if $log['status']==1}
                               <span class='label label-default'>未预约</span>
                              {elseif $log['status']==2}
                              <span class='label label-success'>已预约</span>
                              {elseif $log['status']==3}
                              <span class='label label-danger'>已到院</span>
                              {/if}  
                     </div>
                </div>
            </div>
            
            <div class="form-group">
                <label class="col-xs-12 col-sm-3 col-md-2 control-label">支付状态</label>
                <div class="col-sm-9 col-xs-12">
                     <div class='form-control-static'>
                      {if $log['paytype']==-1}
                              <span class='label label-default'>无需支付</span>
                              {else}
                                    {if $log['paytype']==0}
                                        {if $log['paystatus']==0}
                                        <span class='label label-default'>余额未支付</span>
                                        {else}
                                        <span class='label label-warning'>余额已支付</span>
                                        {/if}
                                    {elseif $log['paytype']==1}
                                      {if $log['paystatus']==0}
                                        <span class='label label-default'>微信未支付</span>
                                        {else}
                                        <span class='label label-warning'>微信已支付</span>
                                        {/if}
                                    {/if}
                               {/if}
                     </div>
                </div>
            </div>
            <div class="form-group">
                <label class="col-xs-12 col-sm-3 col-md-2 control-label">预约信息</label>
                <div class="col-sm-9 col-xs-12">
                    <div class='form-control-static'>
                       姓名：{$log['realname']}<br />
                                   手机：{$log['phone']}<br />
                                   日期：{$log['usedate']}
                              </div>
                </div>
            </div>
            
              <div class="form-group">
                <label class="col-xs-12 col-sm-3 col-md-2 control-label"></label>
                <div class="col-sm-9 col-xs-12">
                     {ifp 'patient.log.exchange'}
                        {if $log['canexchange']}
                                <a class='btn btn-primary' href="javascript:;" onclick='exchange({php echo json_encode($address)})' title='确认到院' >确认到院</a>
                        {/if}
                    {/if}
                <input type="button" class="btn btn-default" name="submit" onclick="history.go(-1)" value="返回列表"  {ifp 'patient.log.exchange'}{if $log['canexchange']}style='margin-left:10px;'{/if}{/if}  />
                </div>
            </div>
            
            
        </div>
     
        
    </div>   
</form>
 {/if}
 <script language='javascript'>
     function exchange(address){
         $('#modal-exchange').find(':input[name=id]').val(address.logid);
         $('#expressform1').show();
         $('#modal-exchange').modal();
     }
     
    </script>

        <div id="modal-exchange" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true" style="width:600px;margin:0px auto;">
            <form class="form-horizontal form" action="{php echo $this->createPluginWebUrl('patient/method',array('op'=>'exchange'))}" method="post" enctype="multipart/form-data">
                <input type='hidden' name='id' value='' />
                <input type='hidden' name='method' value='log' /> 
              <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button aria-hidden="true" data-dismiss="modal" class="close" type="button">×</button>
                        <h3>确认到院</h3>
                    </div>
                    <div class="modal-body">
                        <div id='expressform1' style='display:none'>
                            确认已经到院?
                        </div>
                        <div id="module-menus"></div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary" name="close" value="yes">确认到院</button>
                        <a href="#" class="btn btn-default" data-dismiss="modal" aria-hidden="true">关闭</a>
                    </div>
                </div>
            </div>
            </form>
        </div>
 
<script language='javascript'>
    $(function (){
      
        $("#express").change(function () {
            var obj = $(this);
            var sel = obj.find("option:selected").attr("data-name");
            $("#expresscom").val(sel);
        });
    })
</script>
 
{template 'web/_footer'}
 