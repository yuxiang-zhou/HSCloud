  
    <div class="form-group">
        <label class="col-sm-2 control-label">折扣设置</label>
        <div class="col-sm-10">
            {ife 'goods' $item}
            <label for="discounts_type0" class="radio-inline"><input type="radio" name="discounts[type]" value="0" id="discounts_type0" {if empty($discounts) || $discounts['type'] == 0}checked="true"{/if} /> 统一设置折扣 0.1-10之间</label>
            <label for="discounts_type1" class="radio-inline" {if $item['hasoption']!=1}style='display:none'{/if}><input type="radio" name="discounts[type]" value="1" id="discounts_type1"  {if !empty($discounts) && $discounts['type'] == 1}checked="true"{/if} /> 详细设置折扣</label>
            {else}
            <div class='form-control-static'>
                {if empty($item) || $item['discounts']['type'] == 0}统一设置折扣 0.1-10之间{/if}
                {if !empty($item) && $item['discounts']['type'] == 1}详细设置折扣{/if}
            </div>

            {/if}
        </div>
    </div>

    <div id="discounts_0" {if $discounts['type']!=0} style="display:none;" {/if}>

    <div class="form-group discounts-info">
        <div class="col-sm-12">
            <div class='alert alert-info'>
                只有当折扣大于0，小于10的情况下才能生效，否则按自身会员等级折扣计算<br>
                如果折扣为空或者0，则不设置折扣, 折扣和固定金额都有,则优先使用折扣
            </div>
        </div>
    </div>
    {loop $levels $level}
    <div class="form-group">
        <label class="col-sm-2 control-label">{$level['levelname']}</label>
        <div class="col-sm-6 col-xs-12">
            <div class="input-group">
                <input type="number" name="discounts[{$level['key']}]" class="form-control" value="{php echo is_array($discounts[$level['key']]) ? '' : $discounts[$level['key']]}" data-min="0" data-max="10" />
                <div class="input-group-addon">折 或者 会员价</div>
                <input type="number" name="discounts[{$level['key']}_pay]" class="form-control" value="{php echo is_array($discounts[$level['key'].'_pay']) ? '' : $discounts[$level['key'].'_pay']}" />
                <div class="input-group-addon">元</div>
            </div>
        </div>
    </div>
    {/loop}
    </div>
    <div id="discounts_1" {if $discounts['type']!=1} style="display:none;" {/if}>
        <div class="form-group discounts-info">
            <div class="col-sm-12">
                <div class='alert alert-info'>
                    例如：当前商品原价是100元，如直接填写80，则优惠以后的最终价是80元，如果填写80%则为8 折，为空按自身会员等级折扣计算
                </div>
            </div>
        </div>
    <div id='tbdiscount' style="padding-left:15px;" >
        <div id="discount" style="padding:0;">{if $item['hasoption']==1}{$discounts_html}{/if}</div>
    </div>
    </div>
<script>
    $(function () {
        $("label[for='discounts_type0']").click(function () {
            $("#discounts_1").hide();
            $("#discounts_0").show();
        })
        $("label[for='discounts_type1']").click(function () {
            $("#discounts_0").hide();
            $("#discounts_1").show();
        })
    });
</script>

<script>
$('#myModal').on('show.bs.modal', function (event) {
  var button = $(event.relatedTarget); // Button that triggered the modal

  var refund_id = button.data('refundid'); // Extract info from data-* attributes
  var goodssn = button.data('goodssn'); // Extract info from data-* attributes
  var period = button.data('period'); // Extract info from data-* attributes
  var single_refund_price = button.data('srp'); // Extract info from data-* attributes
  var num_refund = button.data('nf'); // Extract info from data-* attributes
  var activate = button.data('activate'); // Extract info from data-* attributes
  var start_date = button.data('startdate'); // Extract info from data-* attributes
  var end_date = button.data('enddate'); // Extract info from data-* attributes

  var modal = $(this);
  modal.find('.modal-body input[name=refund_id]').val(refund_id);
  modal.find('.modal-body input[name=update_goodssn]').val(goodssn);
  modal.find('.modal-body input[name=update_period]').val(period);
  modal.find('.modal-body input[name=update_single_refund_price]').val(single_refund_price);
  modal.find('.modal-body input[name=update_num_refund]').val(num_refund);
  modal.find('.modal-body input[name=update_activate]').val(activate);


  // get selected time. Note timezone problem not solved
  if (!start_date) {
    start_date = 0;
  }

  if (!end_date) {
    end_date = Math.round(Date.now() / 1000 + 3600 * 24 * 365);
  }

  start_date = new Date(parseInt(start_date)*1000);
  end_date = new Date(parseInt(end_date)*1000);

  var start_date_str = start_date.getFullYear() + "-" + (start_date.getMonth() + 1) + "-" + start_date.getDate() + " " + start_date.getHours() + ":" + start_date.getMinutes();
  var end_date_str = end_date.getFullYear() + "-" + (end_date.getMonth() + 1) + "-" + end_date.getDate() + " " + end_date.getHours() + ":" + end_date.getMinutes();


  modal.find('.modal-body #model_date').html('<div class="col-sm-7 col-lg-9 col-xs-12"><input name="time[start]" type="hidden" value="'+start_date_str+'"><input name="time[end]" type="hidden" value="'+end_date_str+'"><button class="btn btn-default daterange daterange-time" type="button" data-original-title="" title=""><span class="date-title">'+start_date_str+' 至 '+end_date_str+'</span> <i class="fa fa-calendar"></i></button></div>');


  require(["daterangepicker"], function($){
		$(function(){
			$(".daterange.daterange-time").each(function(){
				var elm = this;
				$(this).daterangepicker({
					startDate: $(elm).prev().prev().val(),
					endDate: $(elm).prev().val(),
					format: "YYYY-MM-DD HH:mm",
					timePicker: true,
					timePicker12Hour : false,
					timePickerIncrement: 1,
					minuteStep: 1
				}, function(start, end){
					$(elm).find(".date-title").html(start.toDateTimeStr() + " 至 " + end.toDateTimeStr());
					$(elm).prev().prev().val(start.toDateTimeStr());
					$(elm).prev().val(end.toDateTimeStr());
				});
			});
		});
	});
})
</script>
